.. _framemanage:

--------------------------
Xi Frameデスクトップの管理
--------------------------

AHVクラスターをFrameに登録して顧客エンティティに関連付けたら、AHVクラスターのリソースを使用して最初のFrameアカウントを作成できます。
Frameアカウントには何がありますか？frameアカウントは、少なくとも次のもので構成されます。

- アカウントのゴールドマスターイメージを管理するために使用されるサンドボックスVM。サンドボックスイメージは、テンプレートイメージのコピーです。
- CCAをFrameに追加したときに定義したインスタンスタイプに基づいた「Production」VMの1つ以上のプール。これらの「Production」プールのVMは、エンドユーザーが仮想デスクトップまたは公開アプリケーションにアクセスするために使用されます。

**この演習では、容量、ローンチパッド、ユーザー管理、その他の管理コントロールの構成など、Frameアカウントの構成について学習します。公開されれいるデスクトップをテストした後、Frameを通じてデスクトップの更新および展開する方法を学習します。**

デスクトッププールのデプロイ
++++++++++++++++++++++++

#. **Xi Frame** の左側のメニューから **Accounts** を選択して **Create Account** をクリックします。

#. **Region and Network** で、次の項目を入力して **Next** をクリックします。

   - **Name** - *Initials*\ -W10NP
   - **URL name** - (Default, based on Name)
   - **Cloud Provider** - Nutanix
   - **Region** - *CCAの場所*

   .. figure:: images/1b.png

#. **Configuration** で、次の項目を入力して **Next** をクリックします。
   - **Base Image family** - Windows 10
   - **Instance Type** - AHV 2vCPU 4GB
   - **Disk size** - 100GB *( スライダーまたは数値を入力 )*
   - **Initial capacity** - 1 *( デフォルト値 )*
   - **Persistent desktop** - 選択 **しない**

   .. figure:: images/2a.png

   .. note::

     *（RDSやXenAppのような共有モデルではなく）従来のVDIのように、各ユーザーセッションが専用のVMを使用する場合、FrameがWindows Server OSイメージを使用するのはなぜですか？*

     従来、Microsoft Windowsのライセンス制限により、AWSとAzureはWindows Server OSイメージを提供していました。Windows Serverイメージは、使い慣れたWindowsデスクトップUIで表示され、通常は同じアプリケーションのすべてをサポートします。

     MicrosoftはWindowsライセンスにいくつかの調整を加えたため、Xi FrameはAzureおよびNutanix AHVでWindows 10をサポートできます。お客様は、Windows 10用の独自のMicrosoft VDAライセンスをご持参いただく必要があります。

#. **Create** をクリックして、サンドボックスVMなどの選択に基づいてプールのプロビジョニングを開始します。

   サンドボックスは、すべてのproductionインスタンスを作成するためのベースとして機能する特別なインスタンスです。そのディスクは、しばしば「ゴールドマスター」または「マスターイメージ」と呼ばれます。サンドボックスデスクトップを起動すると、新しいアプリをインストールしたり、システムアップデートを適用したりするための完全な管理アクセス権が付与されます。

#. **Accounts** ページから、作成したアカウントの **Summary** ダッシュボードを開きます。

   .. figure:: images/4.png

   次の演習では、Xi Frameリソースのプールの構成作業を完了し、Frame管理ポータルを詳しく見ていきます。

容量の設定
++++++++++++++++++++

#. サイドバーの **Capacity** をクリックします。

   Frameは、利用可能なデスクトップの最小数と最大数を柔軟に設定できますので、管理者はコストと可用性のバランスを考慮して設定することができます。インスタンスタイプごとに構成することもできます。

#. :fa:`info-circle` アイコンにカーソルを合わせると利用可能なさまざまな管理機能を理解できます。

   Frameでは各VMは同時ユーザー1人をサポートするため、productionプールでサポートされる同時ユーザーの数は、**Max number of instances** と同じである必要があります。

#. **+ Add instance type** をクリックします。

#. **Instance type** ドロップダウンから **AHV AHV 4vCPU 6GB** を選択し **Add** をクリックします。

   .. figure:: images/4a.png

#. 追加した **AHV 4vCPU 6GB** タブをクリックし、 **Max number of instance** の値がゼロである事を確認します。

.. figure:: images/4b.png

#. **AHV 2vCPU 4GB** タブで、 **Buffer instances** を **1** と **Max number of instances** を **3** に増やします。 **Save > Confirm** をクリックします。

   .. figure:: images/5.png

   **Buffer instances** を1に増やすと、Frameは少なくとも1つのVMの電源がオンになり、次ユーザーが使用できるようになります。各ユーザーがFrameセッションに接続すると、Frameは次のVMをパワーオンします。 （ **Max number of instances** の通り、最大インスタンスが3に達するまでこれを繰り返します）。

   .. note::

      クラウドで提供されるデスクトップの場合、電源がオンになっている各VMは、VMが使用されているかどうかに関係なく、AWS、Azure、またはGCPによってVMの料金が発生します。正当な理由がない限り、電源をオンにする **Minimum number of instances** と **Buffer instances** の値は、デフォルトの容量に対して0に設定する必要があります。これら2つのパラメーターが0より大きい場合、AWS、Azure、およびGCPは、パワーオン状態のVMに対して課金します。


#. **Save** をクリックします。

#. **Active capacity** でピーク時（平日と週末など）の使用状況に対応するために個別の容量ポリシーを構成できることを確認します。 **デフォルトの選択のままにします。**

   .. figure:: images/6.png

#. Productionププールの容量を構成したら、テンプレートまたは「ゴールドイメージ」を公開して、デスクトップVMを作成できます。サイドバーから **Sandbox** を選択し **Publish > Publish** をクリックします。

   .. figure:: images/6b.png

   サンドボックスイメージでプロビジョニングする必要のあるVMの数にもよりますが、公開には通常15分以上かかります。アカウント管理者がサンドボックスを公開すると、Frameプラットフォームがサンドボックスイメージをバックアップします。次に、Frameプラットフォームは新しいイメージを使用してシャドウプールでVMをプロビジョニングします。特定のProductionプールの最大容量値により、プロビジョニングされるVMの数が決まります。

   .. During this process you will still be able to connect to and use your original production pool – *zero end-user downtime!* If a user was connected to a session when you initiated a publish, they could continue to work, uninterrupted. Once a user closes (not just disconnect) their session, the instance will be terminated and replaced with a VM from the shadow pool.

   サンドボックスイメージの更新バージョンを公開するたびに、Frameが自動的にバックアップを作成し、必要に応じてProduciton環境を簡単かつ迅速にロールバックできます。

#. 最初のテンプレートが公開されている間、以降のFrame管理ポータルを引き続き学習してください。

ローンチパッドの構成
++++++++++++++++++++++

ローンチパッドはFrameプラットフォームインターフェースのうち、エンドユーザー向けの部分であり、ユーザーはアカウント管理者の許可を得て、公開されたアプリケーションまたはデスクトップにアクセスできます。各ローンチパッドはFrameアカウントに関連付けられており、次のことを設定します。

- ローンチパッドが公開アプリケーション（アプリケーションローンチパッド）またはデスクトップ（デスクトップローンチパッド）へのアクセスを提供するかどうか

- ローンチパッドでの使用が許可されているインスタンスタイプ

- 1つまたは複数のクラウドストレージプロバイダーの可用性を管理するためのセッション設定、セッションタイムアウト、コピー/貼り付け（双方向または単方向）、印刷、ファイルのダウンロード/アップロード、Frame Remoting Protocolを管理するサービス品質（QoS）パラメーターなど

さらに、アカウント管理者は、役割ベースのアクセス制御（RBAC）を使用して、どのエンドユーザーまたはエンドユーザーのグループがどのローンチパッドにアクセスできるかを決定し、それによって、どの公開アプリケーションまたはデスクトップがどのインスタンスタイプで許可されるかを制御できます。

#. サイドバーから **Launchpads** を選択します。 **Add Launchpad** をクリックします。

#. デフォルト値のまま **Add Launchpad** をクリックして、シームレスなアプリケーションを実行するためのローンチパッドを作成します。

   .. figure:: images/7.png

#. **Applications** でご自身のテンプレートイメージ内で検出されたすべてのアプリケーションを公開するため **Add all applications** をクリックします。

   .. figure:: images/8.png

#. 必要に応じて **Manage Applications** をクリックし、トグルスイッチを使用して、ローンチパッドでアプリケーションを追加または削除します。

   .. figure:: images/9.png

   アプリケーションアイコンをドラッグしてエンドユーザーに表示される順序を並べ替えたり、ドラッグして（携帯電話のOSと同様に）ローンチパッド内でアプリをグループ化するためのフォルダーを作成したりできます。

#. **Instance Pools** で **AHV 4vCPU 6GB** トグルをオンにします。

  .. figure:: images/9a.png


  .. note::

      複数のタイプが利用可能な場合、ローンチパッドはインスタンスタイプごとに有効または無効にできます。これは2つの目的で使用されます。

      - ユーザーは特定のインスタンスプールではなくローンチパッドに割り当てられているため、ユーザーを特定のインスタンスタイプ（通常はコスト管理のため）に制限する場合

      - ハイエンドの3D CADアプリケーションなどの特定のアプリを、高性能のGPUアクセラレートVMなどの特定のインスタンスタイプでのみ使用できるようにする場合

#. ローンチパッドのカスタマイズが完了したら **Save** をクリックします。

----------------------------------------------------------------

#. **+ Add Launchpad** をクリックして、カスタマイズされた名前とURLスラグを含む **デスクトップ** ランチパッドを追加します。 **Add Launchpad** をクリックします。

   .. figure:: images/10.png

   このローンチパッドは、デスクトップセッション全体を起動するための単一のアイコンを提供するため、個別に選択するアプリケーションがないことを確認してください。

#. 2つのローンチパッドを視覚的に区別するために、代替の背景画像を選択（または独自の背景画像をアップロード）します。

   アカウント管理者が個別のアプリケーションを提供したい場合（タスク作業でのアプリーケーションを提供する場合や、企業のラップトップなどの既存のデスクトップ環境にアプリケーションを提供する場合）、アプリケーションローンチパッドが適しています。デスクトップに慣れているユーザーグループの場合、アカウント管理者はデスクトップローンチパッドを提供できます。

設定の探索
++++++++++++++++++

#. サイドバーの **Settings** をクリックし **Session** タブを選択します。

   **Session** タブでは、管理者がすべてのローンチパッドのデフォルトのセッション動作を調整できます。

   .. note::

     セッション設定は、Launchpadごとにカスタマイズすることも、許可されている場合はエンドユーザーが直接カスタマイズすることもできます。

     .. figure:: images/11.png

   ユーザーにクラウドストレージへのアクセスを許可したり、アップロード/ダウンロードなどのさまざまな機能を切り替えたり、セッションの時間制限を構成したり **Network** セクションでセッションのQoS設定をカスタマイズすることもできます。

#. すべての **Storage** オプションを有効にして **Save** をクリックします。

   .. figure:: images/12.png

ユーザーの追加
++++++++++++

Frameの新しいユーザーの追加はすばやく簡単です。

#. ツールバーから **Customer** の名前をクリックします。 (例： **nutanix.com-####**).

   .. figure:: images/13.png

#. :fa:`ellipsis-v` **> Users** をクリックします。

   .. figure:: images/14.png

#. **Basic (username/password)** 認証プロバイダーを有効にして **Save** をクリックします。

   .. figure:: images/15.png

   Frameはいくつかの認証メカニズムをサポートしています。

   Okta、Ping、Azure AD、ADFSなどのIDプロバイダー（IdP）のほとんどの企業では、SAML2統合をお勧めします。Googleログインを使用する企業の場合、FrameはOAuth2を介してGoogle Identityと統合されます。

   IdPをお持ちでないお客様向けに、FrameはネイティブIDプロバイダーを提供し、管理者がローカルの電子メールアドレスベースのアカウントを作成および制御できるようにします。

   .. note::

      Frame Basic IDプロバイダーは、エンタープライズIDプロバイダーとして使用するためのものではありません。構成可能なパスワードの強度ポリシー、多要素認証、またはユーザーをグループに集約する機能はサポートされていません。これは、テストにシンプルなIdPが必要なお客様のみを対象としています。Nutanixは、エンタープライズグレードのIDプロバイダーを統合することを強くお勧めします。

   FrameはPlatform as a Serviceであるため、Frameを自社のWebアプリケーションに埋め込むために使用されるエンタープライズおよびパートナー向けのJavaScriptおよびWebサービスAPIの両方があります。WebサービスAPIの場合、APIメカニズムは、フレームAPIエンドポイントに対して認証するためのAPIキーを生成するために使用されます。

   さらに、プロバイダーは、顧客、組織、またはアカウント（プール）ごとに有効化/構成できます。

#. **Basic (username/password)** タブを選択し **Invite Users** をクリックします。

#. ビジネスまたは個人の電子メールアドレスを入力し、作成した **Launchpad User** ロールを追加します。

   .. figure:: images/16.png

#. **Invite** をクリックします。

#. **MyNutanix** を選択し **User Access** の下の **+ Add** をクリックして、My Nutanixアカウントを持つユーザーが作成した各Launchpadにアクセスできるようにします。 **Save** をクリックします。

   .. figure:: images/17.png

   数回クリックするだけで、複数のIDPのユーザーがXi Frameリソースのプールにアクセスできるようになりました。

エンドユーザーエクスペリエンスのテスト
+++++++++++++++++++++++++++

この演習では、エンドユーザーとしてFrameデスクトップに接続します。以下の図は、Nutanix Private Cloudで実行されているFrameデスクトップに接続するユーザーの一般的なネットワークトポロジを示しています。この環境ではLAN経由で接続しているため、ネットワーク負荷のかかるオプションのストリーミングゲートウェイアプライアンスは使用しません。

.. figure:: images/31.png

#. サイドバーから **Accounts >** *Initials*\ **-W10NP** を選択して、プールの管理に戻ります。

   これでイメージの公開が完了しました。これはさまざまな方法で確認できます。 **Summary** ページでバッファの容量の構成により、 **Status** で **1 Active Instance** が表示されます。

#. **Sandbox** をクリックして、サンドボックスに **Last published on...** タイムスタンプが表示され、イメージのスナップショットが **Backups** にあることを確認してください。

#. サイドバーの **Status** をクリックして、3つの **Production** VMがプロビジョニングされ、1つが実行中の **Running** 状態であることを確認します。 **Workload ID** は、Prism の **frame-instance-prod-...** VM名に対応することを確認してください。

   .. figure:: images/18.png

   .. note::

      Prism Centralで **frame-instance-prod-...** VMの1つを選択して、割り当てられたカテゴリを表示してみてください。
      CCAによってクラスター内で自動的に生成された追加のカテゴリーと値は何ですか？

#. ツールバーの右上のドロップダウンメニューでご自身の対象名を選択し **Logout** をクリックします。

#. ユーザーとして環境に再度ログインするには、Nutanix Frameの **You’ve been invited to join Nutanix Frame** を開きます。 **Get Started** リンクを起動して、名前とパスワードを入力します。

   .. figure:: images/19.png

#. **アプリケーションローンチパッド** で提供します。

#. Launchpadの下部にある下部のステータスバーを確認してください。

   .. figure:: images/20.png

   **AHV 2vCPU 4GB** は **Instance Type** を表します。 **AHV 4vCPU 6GB** プロファイルを選択した場合、このインスタンスタイプには容量が構成されていないため、アプリケーションリソースは利用できません。

#. **Google Chrome** をクリックして、最初のFrameのセッションを起動します。

   .. figure:: images/21.png

   完全なデスクトップ配信ではなく、「アプリケーションモード」でGoogle Chromeを起動します。

   環境は最低1VMをプリブートし、1VMの使用可能なバッファーを維持するように構成されているため、セッションはほぼ即座に開始されます。この構成がない場合、ユーザーがローンチパッドでアプリケーションをクリックすると、VMリソースをオンデマンドで起動する必要があるため、初期セッションの起動に最大2分かかる可能性があります。

   ブラウザがFrameのセッションに接続されると、ブラウザ内にChromeが表示されます。Chromeウィンドウのサイズを変更し、Chromeアプリケーションを最大化してブラウザタブ全体を占めることができることを確認してください。ただし、基盤となるデスクトップは表示されません。

   ローカルブラウザウィンドウの下部に表示されるステータスバーの変化を確認してください。

   .. figure:: images/22.png

#. ステータスバーの :fa:`gear` アイコンをクリックして、他のアプリケーションの起動や切り替え、ネットワークQoS設定など、セッション中にユーザーが使用できるアクションを確認します。

#. :fa:`gear` **> Show/hide stats** をクリックすると帯域幅の使用状況を表示するための統計が表示/非表示できます。詳細な統計を表示するには **Session stats** をクリックします。

   .. figure:: images/30.png

   .. note::

      表示が変化しない場合、Frame Remoting Protocolはフレームレートを適応させて0に落とします。消費帯域幅は1kbpsに下がります。

#. 利用可能な最高の品質でYouTube動画の再生を開始し、帯域幅の消費を記録します。消費された帯域幅を確認してください。

#. :fa:`gear` **> Settings** をクリックし  **Max frame rate** と **Max videobit rate** を最低値に下げます。管理者はこれらの設定を制御して、エクスペリエンスと帯域幅の消費のバランスをとることができます。

#. ステータスバーの残りのエレメントにカーソルを合わせると、それらの機能が表示されます。

#. セッションを終了せずにLaunchpadに戻るには、 :fa:`gear` **> Disconnect** クリックします。

#. Launchpadの上部にあるアイコンをクリックして **Desktop** Launchpadに切り替えます。 **Desktop** を起動し、Chromeを実行したまま、同じVMセッションに接続していることを確認します。

   .. figure:: images/23.png

#. **Prism Central** では、追加の **frame-instance-prod-...** VMは1つのVMバッファポリシーを維持するために電源が投入されていることを確認してください。

新しいアプリケーションの追加
+++++++++++++++++++++++

Frameを使用すると、ゴールドマスターのカスタマイズと新しいアプリケーションの追加が非常に簡単になります。

#. Frameデスクトップへの接続を実行したままにします。新しいブラウザータブで https://frame.nutanix.com を開き、ユーザーアカウントから **Log off** します。

#. プロンプトが表示されたら **Sign in with My Nutanix** をクリックし、My Nutanix資格情報を入力します。ユーザー名のドロップダウンメニューから **Go to Dashboard** をクリックして、Frame管理者ポータルにアクセスします。

   .. figure:: images/24.png

#. サイドバーから **Sandbox** を選択し **Power on** をクリックしてサンドボックスVMを起動します。

#. **Status** が **Running** に変わったら **Start session** をクリックして、サンドボックスVMへの接続を開始します。

   .. figure:: images/25.png

#. アプリケーションインストーラーをサンドボックスデスクトップにダウンロードし（以下の例では `PuTTY <https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html>`_ を使用しています）、新しいアプリケーションをインストールします。多くのアプリケーションで、Frameはアプリケーションをインストールしたことを認識し、アプリケーション配信用に登録（オンボード）するかどうかを尋ねます。メッセージが表示されたら **OK** をクリックして、アプリケーションを自動的にFrameにオンボードします。

   .. figure:: images/26.png

   .. note::

      または、アプリケーションアイコンを右クリックして **Onboard to Frame** を選択することもできます。

      .. figure:: images/27.png

      管理者がデスクトップの提供を計画している場合は、サンドボックスにアプリケーションをインストールするだけで、アプリケーション配信用に登録（オンボード）する必要はありません。

#. :fa:`gear` **> Disconnect** してダッシュボードに戻ります。

   新しくアプリケーション配信用に登録（オンボード）したアプリが **Applications** に表示されます。これにカーソルを合わせると、プロパティを編集したり、アプリケーションを削除したりできます。ダッシュボードでアプリケーションを削除すると、オフボーディングと呼ばれ、イメージからは削除されませんが、ラウンチパッドからは削除されます。

#. 必要に応じて、ダッシュボードから不要なアプリケーション（メモ帳など）を削除します。

   .. figure:: images/28.png

   .. note::

     ユーザーがFrameを介してデスクトップ全体にアクセスできる場合、オンボードされていて個別のアプリとして公開されているかどうかに関係なく、イメージ内のすべてのアプリケーションにアクセスできます。

   次に、サンドボックスイメージへの変更を公開して、ユーザーが新しいアプリケーションにアクセスできるようにします。

#. **Sandbox** で :fa:`ellipsis-v` **> Close Session** をクリックして、アクティブなサンドボックスセッションを終了します。

#. **Publish > Publish** をクリックして、更新したイメージを公開します。

   公開には通常15分ほどかかります。この作業中も、Producitonのプールに接続して使用できます。 – *エンドユーザーのダウンタイムはゼロです！* 公開を開始したときにユーザーがセッションに接続していた場合、ユーザーは接続を中断されることなく作業を続けることができます。ユーザーがセッションを閉じる（切断するだけではない）と、インスタンスは終了し、シャドウプールのVMに置き換えられます。

#. サイドバーから **Launchpads** をクリックし **Manage Applications** をクリックします。ゴールデンイメージに追加した新しいアプリケーションを有効にして **Save** をクリックします。

   .. figure:: images/29.png

#. 更新されたイメージが公開されたら、ユーザーのデスクトップセッションに戻り :fa:`gear` **> Close Session > Close Session** をクリックして、セツションを終了します。 **Applications** Launchpad に戻り、新しいアプリケーションの一つを起動します。

   .. note::

      ディスク容量によってはVMリソースがまだプリブートされていない可能性があるため、このセッションの開始には少し時間がかかる場合があります。 **Frame** 管理者ポータルの **Status** ページでステータスを確認できます。

   数分で、ユーザーが利用中の接続を中断することなく、更新されたイメージをリソースプールに展開しました。
